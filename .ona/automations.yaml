# Ona Automations Configuration for Android Development

tasks:
    validateEnvironment:
        name: Validate Android Environment
        description: Verify Android SDK, ADB, and Gradle are properly configured
        triggeredBy:
            - postEnvironmentStart
        command: |
            set -e
            echo "=== Validating Android Development Environment ==="
            
            echo "Checking ADB..."
            adb --version || { echo "❌ ADB not found"; exit 1; }
            
            echo "Checking SDK Manager..."
            sdkmanager --version || { echo "❌ SDK Manager not found"; exit 1; }
            
            echo "Checking Java..."
            java -version || { echo "❌ Java not found"; exit 1; }
            
            echo "Listing installed SDK components..."
            sdkmanager --list_installed
            
            if [ -f "./gradlew" ]; then
              echo "Checking Gradle..."
              ./gradlew --version || { echo "❌ Gradle not working"; exit 1; }
              echo "Listing Gradle tasks..."
              ./gradlew tasks --quiet || ./gradlew tasks
            else
              echo "⚠️  No gradlew found in workspace root"
            fi
            
            echo "✅ Android environment validation complete"
    
    displayEnvironmentInfo:
        name: Display Environment Info
        description: Display Android SDK and environment information
        triggeredBy:
            - postEnvironmentStart
        dependsOn:
            - validateEnvironment
        command: |
            echo "=== Android Development Environment ==="
            echo "ANDROID_HOME: $ANDROID_HOME"
            echo "ANDROID_SDK_ROOT: $ANDROID_SDK_ROOT"
            echo "JAVA_HOME: $JAVA_HOME"
            echo "======================================"
    
    buildDebug:
        name: Build Debug APK
        description: Build the Android app in debug mode
        command: |
            set -e
            if [ -f "./gradlew" ]; then
              ./gradlew assembleDebug
            else
              echo "❌ No gradlew found. Please create an Android project first."
              exit 1
            fi
    
    buildRelease:
        name: Build Release APK
        description: Build the Android app in release mode
        command: |
            set -e
            if [ -f "./gradlew" ]; then
              ./gradlew assembleRelease
            else
              echo "❌ No gradlew found. Please create an Android project first."
              exit 1
            fi
    
    clean:
        name: Clean Build
        description: Clean the Gradle build cache
        command: |
            set -e
            if [ -f "./gradlew" ]; then
              ./gradlew clean
            else
              echo "❌ No gradlew found. Please create an Android project first."
              exit 1
            fi
    
    updateSdk:
        name: Update Android SDK
        description: Update Android SDK components to latest versions
        command: |
            set -e
            echo "Updating Android SDK..."
            sdkmanager --update
            echo "SDK updated successfully"
    
    listDevices:
        name: List Android Devices
        description: List connected Android devices
        command: adb devices -l
